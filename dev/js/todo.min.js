/*! todo - v0.0.0 - 2014-09-03 */var Todo=window.Todo||{};Todo.Models={},Todo.Collections={},Todo.Views={},Todo.Routers={},Todo.Models.ModelBase=Backbone.Model.extend(),Todo.Models.Todo=Todo.Models.ModelBase.extend({defaults:{text:null,completed:!1,ordinal:0},setCompleted:function(){"use strict";this.set("completed",!0),this.save()},setText:function(a){"use strict";this.set("text",a),this.save()},setOrdinal:function(a){"use strict";this.set("ordinal",a)}}),Todo.Collections.CollectionBase=Backbone.Collection.extend(),Todo.Collections.Todos=Todo.Collections.CollectionBase.extend({model:Todo.Models.Todo,localStorage:new Backbone.LocalStorage("todos-backbone"),getAll:function(){"use strict";return this.models},getActive:function(){"use strict";return this.filter(function(a){return!a.get("completed")})},getCompleted:function(){"use strict";return this.filter(function(a){return a.get("completed")})},comparator:function(a){"use strict";return a.get("ordinal")}}),Todo.Views.ViewBase=Backbone.View.extend(),Todo.Views.TodoForm=Todo.Views.ViewBase.extend({initialize:function(){"use strict";this.$input=this.$(".todoForm__input")},events:{submit:"onSubmit"},onSubmit:function(a){"use strict";a.preventDefault(),this.$input.val()&&(this.collection.add(new Todo.Models.Todo({text:this.$input.val(),ordinal:this.collection.length})),this.$input.val(""),this.$input.focus())}}),Todo.Views.TodoList=Todo.Views.ViewBase.extend({events:{updateSort:"onUpdateSort"},initialize:function(){"use strict";this.listenTo(this.collection,"add",this.add),this.listenTo(this.collection,"reset",this.showAll),this.collection.fetch()},add:function(a){"use strict";a.save();new Todo.Views.TodoListItem({model:a});this.render()},showAll:function(){"use strict";this.$el.empty(),this.addItems(this.collection.getAll())},showActive:function(){"use strict";this.$el.empty(),this.addItems(this.collection.getActive())},showCompleted:function(){"use strict";this.$el.empty(),this.addItems(this.collection.getCompleted())},addItems:function(a){"use strict";for(var b=0;b<a.length;b++)this.add(a[b])},onUpdateSort:function(a,b,c){"use strict";this.collection.remove(b),this.collection.each(function(a,b){var d=b;b>=c&&(d+=1),a.setOrdinal(d)}),b.setOrdinal(c),this.collection.add(b,{at:c}),this.collection.each(function(a){a.save()}),this.collection.sort(),this.render()},render:function(){"use strict";return this.$el.children().remove(),this.collection.each(this.appendModelView,this),this},appendModelView:function(a){"use strict";var b=new Todo.Views.TodoListItem({model:a}).render().el;this.$el.append(b)}}),Todo.Views.TodoListItem=Todo.Views.ViewBase.extend({tagName:"li",className:"todoListItem",tmpl:'<p class="todoListItem__view"><input type="checkbox" class="todoListItem__checkbox"><span class="todoListItem__text"><%= text %></span><a href="#" class="todoListItem__deleteButton">delete</a></p><form class="todoListItem__editor"><input type="text" class="todoListItem__input" value="<%= text %>"></form>',events:{"change .todoListItem__checkbox":"onChangeCheckbox","click .todoListItem__deleteButton":"onClick",dblclick:"onDoubleClick",submit:"onSubmit",drop:"onDrop"},initialize:function(a){"use strict";this.model=a.model,this.render(),this.listenTo(this.model,"destroy",this.remove)},render:function(){"use strict";var a=_.template(this.tmpl,this.model.toJSON());return this.$el.html(a),this.model.get("completed")&&this.setCompleted(this.$(".todoListItem__checkbox")),this},onChangeCheckbox:function(a){"use strict";this.setCompleted(a.target)},onClick:function(){"use strict";this.model.destroy()},onDoubleClick:function(){"use strict";if(!this.model.get("completed")){this.$el.addClass("todoListItem--edit");var a=this.$el.find(".todoListItem__input");a.val(this.model.get("text")),a.focus()}},onSubmit:function(){"use strict";var a=this.$el.find(".todoListItem__input");a.val()&&(this.model.setText(a.val()),this.render()),this.$el.removeClass("todoListItem--edit")},setCompleted:function(a){"use strict";this.model.setCompleted(),$(a).prop("disabled",!0),$(a).prop("checked",!0),this.$el.addClass("todoListItem--completed")},onDrop:function(a,b){"use strict";this.$el.trigger("updateSort",[this.model,b])}}),Todo.Routers.RouterBase=Backbone.Router.extend(),Todo.Routers.TodoRouter=Todo.Routers.RouterBase.extend({initialize:function(a){"use strict";this.listView=a.view,this.collection=a.collection},routes:{active:"active",completed:"completed",all:"all"},all:function(){"use strict";this.listView.showAll()},active:function(){"use strict";this.listView.showActive()},completed:function(){"use strict";this.listView.showCompleted()}});var todos=new Todo.Collections.Todos,todoForm=new Todo.Views.TodoForm({el:".todoForm",collection:todos}),todoList=new Todo.Views.TodoList({el:".todoList",collection:todos}),todoRouter=new Todo.Routers.TodoRouter({view:todoList,collection:todos});Backbone.history.start(),$(function(){"use strict";$(".sortable").sortable({update:function(a,b){b.item.trigger("drop",b.item.index())}})});